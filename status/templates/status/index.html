{% extends 'base.html' %}
{% load staticfiles %}
{% block content %}
{% block head_extends %}
<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
{% endblock %}

<div class="main-body" style="min-hight:1600px">
  <div class="content">
      <section class="sub-header" style="display:none;">
  			<section class="mobSecNav">
                <img id="subNavlogo" src="{% static 'img/mnav2.png'%}" style="padding-bottom:6px;"></section>
  			<section class="mobSecNavMenu">
  				<ul>
  					<li><a href="news.html">最新动态</a></li>
  				</ul>
  			</section>
        <section class="secNav">
  				<ul>
  					<li  class="cur"><a href="news.html">最新动态</a></li>
  				</ul>
  			</section>
  		</section>


<div class="col_lg_12">
    <div class="mainContent">
        <div class="introTit clearfix">
            <h2>运行状态</h2>
        </div>

    </div>
 </div>

 <div class="row">
  <div class="col-md-6">
    <h1>CPU使用率</h1>
      <div id="CPU" ></div>
  </div>
  <div class="col-md-6">
      <h1>内存使用率</h1>
      <div id="Memory"></div>
  </div>
</div>

      <hr>
<div class="row">
  <div class="col-md-6">
    <h1>分组CPU使用率</h1>
      <div id="group_cpu" ></div>
  </div>
  <div class="col-md-6">
      <h1>分组内存使用率</h1>
      <div id="group_memory"></div>
  </div>
</div>

      <hr>
<div class="row">
  <div class="col-md-6">
    <h1>存储使用率</h1>
      <div id="line21" ></div>
  </div>
  <div class="col-md-6">
      <h1>运行队列</h1>
      <div id="line22"></div>
  </div>
</div>

    <div class="clearfix"></div>
  </div>
</div>

{% endblock %}

{% block script_extends %}

<script src="http://cdn.highcharts.com.cn/highcharts/highcharts.js"></script>
<script type="text/javascript">
     Highcharts.setOptions({ global: { useUTC: false } });
</script>

<script src="{% static 'ajax/cpu.js'%}"></script>
<script src="{% static 'ajax/memory.js'%}"></script>
<script src="{% static 'ajax/group_cpu.js'%}"></script>
<!--<script src="{% static 'ajax/group_memory.js'%}"></script>-->

<script>

var seriesOptions = [],
		seriesCounter = 0,
		names = ['MSFT', 'AAPL', 'GOOG'];
/**
     * Create the chart when all data is loaded
     * @returns {undefined}
     */
function createChart() {
		Highcharts.stockChart('group_cpu', {
				chart: {
						zoomType: null,
						// pinchType: null
				},
				rangeSelector: {
						selected: 4
				},
				yAxis: {
						labels: {
								formatter: function () {
										return (this.value > 0 ? ' + ' : '') + this.value + '%';
								}
						},
						plotLines: [{
								value: 0,
								width: 2,
								color: 'silver'
						}]
				},
				plotOptions: {
						series: {
								compare: 'percent',
								showInNavigator: true
						}
				},
				tooltip: {
						pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
						valueDecimals: 2,
						followTouchMove: false,
						split: true
				},
				series: seriesOptions
		});
}
$.each(names, function (i, name) {
		$.getJSON('https://data.jianshukeji.com/jsonp?filename=json/' + name.toLowerCase() + '-c.json&callback=?',    function (data) {
				seriesOptions[i] = {
						name: name,
						data: data
				};
				// As we're loading the data asynchronously, we don't know what order it will arrive. So
				// we keep a counter and create the chart when all the data is loaded.
				seriesCounter += 1;
				if (seriesCounter === names.length) {
						createChart();
				}
		});
});


function CPUtimeDown(limit) {
   if (limit == 60) {
   get_cpu();
   }
   limit--;

   if (limit < 0) {
       limit = 60;
   }

   setTimeout(function() {
       CPUtimeDown(limit);
   }, 1000)
}


function MemorytimeDown(limit) {
   if (limit == 60) {
   get_memory();
   }
   limit--;

   if (limit < 0) {
       limit = 60;
   }

   setTimeout(function() {
       MemorytimeDown(limit);
   }, 1000)
}

function groupCputimeDown(limit) {
   if (limit == 60) {
   get_group_cpu();
   }
   limit--;

   if (limit < 0) {
       limit = 60;
   }

   setTimeout(function() {
       groupCputimeDown(limit);
   }, 1000)
}

$(document).ready(function() {
   CPUtimeDown(60);
   MemorytimeDown(60);
})
</script>

{% endblock %}